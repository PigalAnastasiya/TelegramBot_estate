# TelegramBot_estate

# Телеграм-Бот "Поиск Недвижимости в Черногории"

## Структура Проекта

- `main.py`: Основной файл для запуска телеграм-бота.
- `utils.py`: Вспомогательные функции.
- `nlp.py`: Функции для работы с NLP.
- `bot_handlers.py`: Обработчик сообщений для телеграм-бота.
- `parsing_site_potok_ru.py`: Скрипт для получения данных с сайта.

## Основные Библиотеки и Модули

- `pandas`: Для работы с данными в формате DataFrame.
- `telegram`: Для взаимодействия с Telegram API.
- `torch` и `numpy`: Для работы с тензорами и массивами в машинном обучении.
- `transformers`: Для использования предобученных моделей NLP (BERT и RoBERTa).
- `logging`: Для логирования информации о работе бота.
- `requests` и `PIL`: Для работы с изображениями и запросами к веб-ресурсам.
- `nltk` и `spacy`: Для обработки естественного языка, включая лемматизацию и распознавание именованных сущностей (NER).

## Функции Предобработки и Обработки Текста

- `preprocess_text(text, language)`: Очистка и нормализация текста, удаление стоп-слов.
- `preprocess_user_query(query)`: Замена синонимов в запросе пользователя.
- `get_wordnet_pos(word)`: Определение части речи слова для лемматизации.
- `translate(text)`: Перевод текста с использованием модели MarianMTModel.
- `get_embedding(text, model, tokenizer)`: Получение эмбеддингов текста с использованием моделей BERT или RoBERTa.
- `enhance_text_with_keywords(text, keywords)`: Усиление текста ключевыми словами для улучшения сопоставления запросов.

## Обработка Изображений

- `is_valid_image_url(url)`: Проверка, является ли URL действительным изображением.

## Обработчики Бота

- `start(update, context)`: Обработчик команды /start, отправляющий приветственное сообщение.
- `handle_message(update, context)`: Основной обработчик текстовых сообщений, включающий в себя:
  - Перевод текста запроса.
  - Предобработку и лемматизацию текста.
  - Генерацию эмбеддингов и сравнение их с эмбеддингами объявлений о недвижимости.
  - Отправку подходящих объявлений пользователю.

## Prerequisites (Предварительные Требования)

Прежде чем запустить телеграм-бот "Поиск Недвижимости в Черногории", необходимо выполнить ряд предварительных шагов:

### Регистрация Телеграм Бота

1. **Создание бота через BotFather:**

   - Откройте Telegram и найдите пользователя `@BotFather`.
   - Напишите `/newbot` и следуйте инструкциям для создания нового бота.
   - После создания бота, BotFather предоставит токен для доступа к HTTP API. Сохраните этот токен, он понадобится для настройки вашего бота.

2. **Конфигурация бота:**

   - Вы можете настроить имя бота, описание, аватар и другие параметры через BotFather, используя соответствующие команды (например, `/setname`, `/setdescription`, `/setuserpic` и т.д.).

3. **Безопасность:**
   - Убедитесь, что вы никому не передаёте токен вашего бота и не храните его в общедоступных местах.

### Установка Зависимостей

Убедитесь, что все необходимые библиотеки установлены в вашей виртуальной среде, как описано в разделе "Основные Библиотеки и Модули".

## Запуск и Конфигурация Бота

- `main()`: Функция для настройки и запуска бота.

## Используемые Модели NLP и ML

- BERT и RoBERTa: для генерации эмбеддингов текста.
- MarianMTModel: для перевода текста.
- spaCy, NER: для распознавания именованных сущностей.

## Автоматический Запуск Скрипта `parsing_site_potok_ru.py` с Использованием CRON

Скрипт `parsing_site_potok_ru.py` настроен на ежедневный запуск в 3:00 утра для обновления файла с данными. Для этого используется CRON в Unix-подобных системах.

### Шаги для Настройки CRON

1. **Открыть редактор CRON:**

   - Введите команду в терминале:
     ```bash
     crontab -e
     ```

2. **Добавить задачу в CRON:**

   - В редакторе CRON добавьте следующую строку, чтобы запускать скрипт каждый день в 3:00 утра:
     ```bash
     0 3 * * * /usr/bin/python3 /путь/к/проекту/parsing_site_potok_ru.py
     ```
     - Замените `/путь/к/проекту/` на полный путь к директории, где находится скрипт.
     - Убедитесь, что указан правильный путь к интерпретатору Python.

3. **Сохранить и закрыть редактор CRON:**

   - Сохраните изменения и закройте редактор.

4. **Проверить список задач CRON:**
   - Убедитесь, что задача добавлена, с помощью команды:
     ```bash
     crontab -l
     ```

### Логирование Работы Скрипта

- Для отслеживания выполнения скрипта рекомендуется настроить логирование.
- Добавьте перенаправление вывода в файл логов, изменив строку задачи в CRON следующим образом:
  ```bash
  0 3 * * * /usr/bin/python3 /путь/к/проекту/parsing_site_potok_ru.py >> /путь/к/логу/logfile.log 2>&1
  ```

## Ключевые Пункты для Улучшения

- Рассмотреть добавление функциональности для интерактивного общения с пользователем, задавая уточняющие вопросы.
- Возможность оценки релевантности результатов пользователем для последующего улучшения алгоритмов поиска.
- Использование дополнительных NLP техник для анализа контекста запроса.
